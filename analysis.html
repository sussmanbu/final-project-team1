<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Here we provide a detailed analysis using more sophisticated statistics techniques.">

<title>MA [46]15 Final Project team 1 - Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project team 1</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./big_picture.html" rel="" target="">
 <span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis.html" rel="" target="" aria-current="page">
 <span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><strong>Introduction</strong></a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><strong>Analysis</strong></a></li>
  <li><a href="#descriptive-statistics-correlation-of-relevant-factors" id="toc-descriptive-statistics-correlation-of-relevant-factors" class="nav-link" data-scroll-target="#descriptive-statistics-correlation-of-relevant-factors"><strong>Descriptive Statistics: Correlation of Relevant Factors</strong></a></li>
  <li><a href="#exploratory-analysis-relationships-between-variables" id="toc-exploratory-analysis-relationships-between-variables" class="nav-link" data-scroll-target="#exploratory-analysis-relationships-between-variables"><strong>Exploratory Analysis: Relationships Between Variables</strong></a></li>
  <li><a href="#model-predictions" id="toc-model-predictions" class="nav-link" data-scroll-target="#model-predictions"><strong>Model Predictions</strong></a></li>
  <li><a href="#geospatial-analysis" id="toc-geospatial-analysis" class="nav-link" data-scroll-target="#geospatial-analysis"><strong>Geospatial Analysis</strong></a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><strong>Limitations</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis</h1>
</div>

<div>
  <div class="description">
    Here we provide a detailed analysis using more sophisticated statistics techniques.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="images/analysis.webp" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><strong>Introduction</strong></h2>
<p>Urban violence remains a pervasive challenge that affects cities worldwide. In Boston, variations in violent crime rates across different neighborhoods suggest a complex interplay of socioeconomic factors. This study aims to dissect the relationship between socioeconomic status—measured through variables such as income, employment, and education—and the frequency of gun violence within Boston’s diverse districts. By exploring these relationships, the study seeks to identify potential mechanisms for policy action that could mitigate violence and enhance urban safety.</p>
<p>Our analysis revolves around several pivotal questions: Does higher income correlate with lower incidences of gun violence? What role does employment stability play in mitigating urban violence? How does educational attainment influence these dynamics? We hypothesized that higher socioeconomic status, indicated by increased income levels, stable employment, and higher educational attainment, is associated with reduced instances of gun violence. To test these hypotheses, we employ statistical models, including linear and logistic regressions, to examine these relationships, focusing on extracting meaningful patterns from a decade of data. This approach allows us to assess the strength and significance of these socioeconomic factors in relation to urban violence, providing a data-driven basis for recommendations and policy considerations.</p>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis"><strong>Analysis</strong></h2>
</section>
<section id="descriptive-statistics-correlation-of-relevant-factors" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-statistics-correlation-of-relevant-factors"><strong>Descriptive Statistics: Correlation of Relevant Factors</strong></h2>
<p>To understand the underlying relationship between our independent and dependent variables, we calculated the correlation matrix to display the direction and magnitude of the relationships present in our data. As shown by the bottom row of our table, our dependent variable total cases is positively correlated with unemployment, the proportion of single parent households in a given district, and percentage of the population that is Black or African American. For interpretation, it is important to note that this does not imply a causal effect, and the following analysis will explain why certain demographics are more correlated with total incidents by further exploring socioeconomic effects.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exploratory-analysis-relationships-between-variables" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-analysis-relationships-between-variables"><strong>Exploratory Analysis: Relationships Between Variables</strong></h2>
<p>While our data is distributed across the Boston area, we are interested in the independent effects of each of our variables at the district level. We plot median income against the total number of cases to assess whether the direction and magnitude of correlation over all districts is still relevant. Considering Dorchester and Roxbury districts are where a significant proportion of incidents are reported, we see that as median income increases, total number of cases decreases indicating employment stability (or potentially higher pay) may play a significant role in hindering gun violence. Similarly in Mattapan there appears to be a slightly negative effect indicating the importance of median income in the top three districts for the total number of cases.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Before modeling our data, we would like to assess the linearity of each of our dependent variables with total cases. Given the individual scatter plots, it appears that median income and bachelors degree have increasing marginal effects, so we incorporate a polynomial term for each of these variables in the non linear regression model below. As part of our summary statistics, it is important to consider the following coefficients for each trend line; bachelor’s degree, number of married households, and median income displayed negative effects while single parent households, unemployment, and vacant houses displayed positive effects.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model-predictions" class="level2">
<h2 class="anchored" data-anchor-id="model-predictions"><strong>Model Predictions</strong></h2>
<p>The regression summaries output the results for two distinct models: a log regression that includes all of our variables for district, race and socioeconomic factors, and a non-linear regression with socioeconomic and race regressors. We performed variable selection utilizing AIC stopping criterion for both models to limit the potential for collinearity. When controlling for all factors, the percentage of white and black population were chosen in our variable selection process further demonstrating the importance of considering the segregation of Boston neighborhoods shown below. For our non linear regression, all variables selected our significance at the 5% level.</p>

<table style="text-align:center">
<caption>
<strong>Log Regression Results</strong>
</caption>
<tbody><tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
log(total_cases)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
pct_white
</td>
<td>
-5.135<sup>*</sup> (2.865)
</td>
</tr>
<tr>
<td style="text-align:left">
pct_black
</td>
<td>
3.800 (2.347)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameDorchester
</td>
<td>
0.254 (1.452)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameEast Boston
</td>
<td>
-0.366 (0.448)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameHyde Park
</td>
<td>
-1.733 (1.563)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameJamaica Plain
</td>
<td>
-0.141 (0.824)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameMattapan
</td>
<td>
-0.744 (2.332)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameRoxbury
</td>
<td>
1.073 (1.041)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameSouth Boston
</td>
<td>
1.170<sup>***</sup> (0.286)
</td>
</tr>
<tr>
<td style="text-align:left">
district_nameSouth End
</td>
<td>
0.551 (0.414)
</td>
</tr>
<tr>
<td style="text-align:left">
married_house
</td>
<td>
15.891<sup>**</sup> (7.062)
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
1.501 (1.414)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
63
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.926
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.910
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
0.374 (df = 51)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
57.719<sup>***</sup> (df = 11; 51)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>

</tbody></table>
<table style="text-align:center">
<caption>
<strong>Non-Linear Regression Results</strong>
</caption>
<tbody><tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
total_cases
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
pct_asian
</td>
<td>
-234.301<sup>***</sup> (36.265)
</td>
</tr>
<tr>
<td style="text-align:left">
pct_aian
</td>
<td>
-1,568.577<sup>**</sup> (639.366)
</td>
</tr>
<tr>
<td style="text-align:left">
unemployment
</td>
<td>
407.260<sup>***</sup> (53.735)
</td>
</tr>
<tr>
<td style="text-align:left">
medincome_mean
</td>
<td>
-0.001<sup>***</sup> (0.0004)
</td>
</tr>
<tr>
<td style="text-align:left">
I(medincome_mean2)
</td>
<td>
0.000<sup>***</sup> (0.000)
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
4.756 (21.885)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
63
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.688
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.661
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
12.173 (df = 57)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
25.162<sup>***</sup> (df = 5; 57)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>

</tbody></table>
</section>
<section id="geospatial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="geospatial-analysis"><strong>Geospatial Analysis</strong></h2>
<p>The segregation map shows the local segregation index of different areas in Boston. The higher an area’s index is (from 0 to 1), the less racially diverse it is. Notably, the most segregated areas are Roxbury and Mattapan. (South Boston).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As shown by our descriptive statistics and regression results, our data is highly correlated with location, therefore our regressors cannot be treated as randomly assigned and they violate the independence assumption for OLS. To overcome this limitation, we perform a geospatial robust weighted regression from the GWmodel R package which computes a local regression for each location, while including a distance decay function, or a weight added to the sum of linear combinations which specifies how observations outside the current location will be weighted. A kernel bandwidth is implemented to determine the cutoff distance for observations included. The local parameters returned by the model are plotted below.</p>
<p>This map shows how well our model performs in predicting cases among the Boston districts. Across the map, our score was close to 1, indicating a high accuracy (good model fit ~ most variables can be explained).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This map is another exemplification that as more bachelor’s degrees are attained, the number of cases decreases. This is especially true in areas that have a higher segregation index, so we can infer that higher level educational attainment has a significant effect on the number of cases in a geospatial location.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations"><strong>Limitations</strong></h2>
<p>The analysis conducted in this study faces several potential issues related to the data that could impact the validity and reliability of the findings. Among these is the inconsistency in reporting across different districts, which may arise from variations in how incidents are classified or documented by different officers, leading to differences in data quality. Moreover, the dataset excludes justifiable and self-inflicted shootings, potentially skewing the comprehensive understanding of the city’s gun violence.</p>
<p>Additional challenges include potential biases in how incidents are reported. Systemic biases within law enforcement practices could influence reporting rates. For example, certain neighborhoods may experience underreporting due to strained community-police relations or resource constraints. Furthermore, differing enforcement practices could lead to an overrepresentation of certain demographics as victims, introducing biases that may distort the perceived demographic patterns of gun violence.</p>
<p>These factors call for a cautious interpretation of the study’s results and point to the need for further research. Incorporating variables such as police presence, public health initiatives, and community programs, could provide a fuller picture of the factors influencing urban violence. Moreover, while this study identifies correlations between socioeconomic status and gun violence, establishing causation requires additional longitudinal and experimental research to explore the underlying mechanisms more definitively.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>