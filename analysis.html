<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Here we provide a detailed analysis using more sophisticated statistics techniques.">

<title>MA [46]15 Final Project team 1 - Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project team 1</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./big_picture.html" rel="" target="">
 <span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis.html" rel="" target="" aria-current="page">
 <span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#example-of-loading-data" id="toc-example-of-loading-data" class="nav-link active" data-scroll-target="#example-of-loading-data">Example of loading data</a></li>
  <li><a href="#note-on-attribution" id="toc-note-on-attribution" class="nav-link" data-scroll-target="#note-on-attribution">Note on Attribution</a></li>
  <li><a href="#rubric-on-this-page" id="toc-rubric-on-this-page" class="nav-link" data-scroll-target="#rubric-on-this-page">Rubric: On this page</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis</h1>
</div>

<div>
  <div class="description">
    Here we provide a detailed analysis using more sophisticated statistics techniques.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg" class="img-fluid"></p>
<p>This comes from the file <code>analysis.qmd</code>.</p>
<p>We describe here our detailed data analysis. This page will provide an overview of what questions you addressed, illustrations of relevant aspects of the data with tables and figures, and a statistical model that attempts to answer part of the question. You’ll also reflect on next steps and further analysis.</p>
<p>The audience for this page is someone like your class mates, so you can expect that they have some level of statistical and quantitative sophistication and understand ideas like linear and logistic regression, coefficients, confidence intervals, overfitting, etc.</p>
<p>While the exact number of figures and tables will vary and depend on your analysis, you should target around 5 to 6. An overly long analysis could lead to losing points. If you want you can link back to your blog posts or create separate pages with more details.</p>
<p>The style of this paper should aim to be that of an academic paper. I don’t expect this to be of publication quality but you should keep that aim in mind. Avoid using “we” too frequently, for example “We also found that …”. Describe your methodology and your findings but don’t describe your whole process.</p>
<section id="example-of-loading-data" class="level3">
<h3 class="anchored" data-anchor-id="example-of-loading-data">Example of loading data</h3>
<p>The code below shows an example of loading the loan refusal data set (which you should delete at some point).</p>
<p>library(tidyverse) print(getwd()) data &lt;- read_csv(here::here(“dataset/loan_refusal_clean.csv”)) load(here::here(“dataset/loan_refusal.RData”)) print(ls())</p>
</section>
<section id="note-on-attribution" class="level2">
<h2 class="anchored" data-anchor-id="note-on-attribution">Note on Attribution</h2>
<p>In general, you should try to provide links to relevant resources, especially those that helped you. You don’t have to link to every StackOverflow post you used but if there are explainers on aspects of the data or specific models that you found helpful, try to link to those. Also, try to link to other sources that might support (or refute) your analysis. These can just be regular hyperlinks. You don’t need a formal citation.</p>
<p>If you are directly quoting from a source, please make that clear. You can show quotes using <code>&gt;</code> like this</p>
<pre><code>&gt; To be or not to be.</code></pre>
<blockquote class="blockquote">
<p>To be or not to be.</p>
</blockquote>
<hr>
</section>
<section id="rubric-on-this-page" class="level2">
<h2 class="anchored" data-anchor-id="rubric-on-this-page">Rubric: On this page</h2>
<p>You will</p>
<ul>
<li>Introduce what motivates your Data Analysis (DA)
<ul>
<li>Which variables and relationships are you most interested in?</li>
<li>What questions are you interested in answering?</li>
<li>Provide context for the rest of the page. This will include figures/tables that illustrate aspects of the data of your question.</li>
</ul></li>
<li>Modeling and Inference
<ul>
<li>The page will include some kind of formal statistical model. This could be a linear regression, logistic regression, or another modeling framework.</li>
<li>Explain the ideas and techniques you used to choose the predictors for your model. (Think about including interaction terms and other transformations of your variables.)</li>
<li>Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.</li>
</ul></li>
<li>Explain the flaws and limitations of your analysis
<ul>
<li>Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions?</li>
</ul></li>
<li>Clarity Figures
<ul>
<li>Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?</li>
<li>Each figure should provide a key insight. Too many figures or other data summaries can detract from this. (While not a hard limit, around 5 total figures is probably a good target.)</li>
<li>Default <code>lm</code> output and plots are typically not acceptable.</li>
</ul></li>
<li>Clarity of Explanations
<ul>
<li>How well do you explain each figure/result?</li>
<li>Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?</li>
</ul></li>
<li>Organization and cleanliness.
<ul>
<li>Make sure to remove excessive warnings, hide most or all code, organize with sections or multiple pages, use bullets, etc.</li>
<li>This page should be self-contained, i.e.&nbsp;provide a description of the relevant data.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo

Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData

Attaching package: 'car'

The following object is masked from 'package:dplyr':

    recode

The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(segregation)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>To enable caching of data, set `options(tigris_use_cache = TRUE)`
in your R script or .Rprofile.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(olsrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'olsrr'

The following object is masked from 'package:datasets':

    rivers</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GWmodel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: robustbase
Loading required package: sp
Loading required package: Rcpp
Welcome to GWmodel version 2.3-2.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>final_df<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">'all_census_dat.rdr'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#correlation table for all independent variables</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>independent_dat<span class="ot">&lt;-</span>final_df<span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name)<span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">aian_pct =</span> <span class="fu">mean</span>(American_Indian_and_Alaska_Native_alone<span class="sc">/</span>total_pop),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">nhpt_pct =</span> <span class="fu">mean</span>(Native_Hawaiian_and_Other_Pacific_Islander_alone<span class="sc">/</span>total_pop), </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">asian_pct =</span> <span class="fu">mean</span>(Asian_alone<span class="sc">/</span>total_pop),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_black =</span> <span class="fu">mean</span>(Black_or_African_American_alone<span class="sc">/</span>total_pop),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_white =</span> <span class="fu">mean</span>(White_alone<span class="sc">/</span>total_pop),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">unemployment=</span><span class="fu">mean</span>(not_in_labor_force<span class="sc">/</span>total_pop),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">medincome_mean=</span> <span class="fu">mean</span>(household_medincome),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">bachelors =</span> <span class="fu">mean</span>(bachelors_25<span class="sc">/</span>total_pop),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">one_parent=</span> <span class="fu">mean</span>(one_parent<span class="sc">/</span>total_house_units),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">married_house=</span> <span class="fu">mean</span>(married_households<span class="sc">/</span>total_house_units),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">vacant_houses =</span> <span class="fu">mean</span>(vacancy_status<span class="sc">/</span>total_house_units),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num)))<span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>district_name,<span class="sc">-</span>total_cases)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>dependent_dat<span class="ot">&lt;-</span>final_df<span class="sc">%&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name)<span class="sc">%&gt;%</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num)))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>correlation_coeffs <span class="ot">&lt;-</span> <span class="fu">cor</span>(dependent_dat<span class="sc">$</span>total_cases, independent_dat)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(independent_dat)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>correlation_values <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(correlation_coeffs)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> variable_names,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Correlation_Coefficient =</span> correlation_values</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlation_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Variable Correlation_Coefficient
1        aian_pct             0.005291498
2        nhpt_pct            -0.472915178
3       asian_pct            -0.266399181
4       pct_black             0.691476968
5       pct_white            -0.689920042
6    unemployment             0.490301785
7  medincome_mean            -0.609812831
8       bachelors            -0.548791943
9      one_parent             0.561080801
10  married_house            -0.658854154
11  vacant_houses             0.142751407</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#time to work plot </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name)<span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>(aggregate_time_to_work)<span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">work_time=</span> <span class="fu">mean</span>(aggregate_time_to_work), <span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num))) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( work_time,total_cases))<span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span><span class="st">'lm'</span>)<span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'Avg travel time to work'</span>,<span class="at">title =</span> <span class="st">'Avg Travel Time to Work and Total Cases'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#income plot</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name)<span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">medincome_mean=</span> <span class="fu">mean</span>(household_medincome), <span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num))) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(district_name, medincome_mean,<span class="at">fill =</span> total_cases))<span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span> <span class="st">'identity'</span>)<span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'Avg median income'</span>,<span class="at">title =</span> <span class="st">'Avg Median Income and Total Cases Over All Years'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#single parent plot </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name)<span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">single_household =</span> <span class="fu">mean</span>(one_parent<span class="sc">/</span> total_house_units),<span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num))) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(district_name,single_household, <span class="at">fill =</span> total_cases))<span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span> <span class="st">'identity'</span>)<span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Pct of Households with Single Parent'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ols all variables </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>lm_dat<span class="ot">&lt;-</span>final_df<span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name, year)<span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">aian_pct =</span> <span class="fu">mean</span>(American_Indian_and_Alaska_Native_alone<span class="sc">/</span>total_pop),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">nhpt_pct =</span> <span class="fu">mean</span>(Native_Hawaiian_and_Other_Pacific_Islander_alone<span class="sc">/</span>total_pop), </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">asian_pct =</span> <span class="fu">mean</span>(Asian_alone<span class="sc">/</span>total_pop),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_black =</span> <span class="fu">mean</span>(Black_or_African_American_alone<span class="sc">/</span>total_pop),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_white =</span> <span class="fu">mean</span>(White_alone<span class="sc">/</span>total_pop),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">unemployment=</span><span class="fu">mean</span>(not_in_labor_force<span class="sc">/</span>total_pop),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">medincome_mean=</span> <span class="fu">mean</span>(household_medincome),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">bachelors =</span> <span class="fu">mean</span>(bachelors_25<span class="sc">/</span>total_pop),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">one_parent=</span> <span class="fu">mean</span>(one_parent<span class="sc">/</span>total_house_units),</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">married_house=</span> <span class="fu">mean</span>(married_households<span class="sc">/</span>total_house_units),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">vacant_houses =</span> <span class="fu">mean</span>(vacancy_status<span class="sc">/</span>total_house_units),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">travel_work =</span> <span class="fu">mean</span>(aggregate_time_to_work),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'district_name'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#OLS with all variables </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ols<span class="ot">&lt;-</span><span class="fu">lm</span>(total_cases<span class="sc">~</span>travel_work<span class="sc">+</span> pct_white<span class="sc">+</span>pct_black<span class="sc">+</span>asian_pct<span class="sc">+</span>nhpt_pct<span class="sc">+</span>aian_pct<span class="sc">+</span>district_name<span class="sc">+</span> unemployment<span class="sc">+</span> medincome_mean<span class="sc">+</span>bachelors<span class="sc">+</span>one_parent<span class="sc">+</span> vacant_houses<span class="sc">+</span>married_house, <span class="at">data =</span> lm_dat)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ols, <span class="at">vcov. =</span> vcovHC) <span class="co"># data is heteroskedastic, opted to use the heteroskedastic robust standard errors </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                              Estimate  Std. Error t value Pr(&gt;|t|)
(Intercept)                 9.7937e+01  1.0228e+02  0.9575   0.3442
travel_work                -4.0187e-05  3.7838e-05 -1.0621   0.2947
pct_white                  -1.0627e+02  1.2048e+02 -0.8820   0.3832
pct_black                   1.1077e+02  8.1762e+01  1.3548   0.1833
asian_pct                  -1.2785e+02  1.7671e+02 -0.7235   0.4737
nhpt_pct                    2.2813e+03  2.7216e+03  0.8382   0.4070
aian_pct                   -4.9210e+02  5.5318e+02 -0.8896   0.3791
district_nameDorchester    -5.4193e+01  5.6794e+01 -0.9542   0.3459
district_nameEast Boston   -3.2850e+01  3.9127e+01 -0.8396   0.4063
district_nameHyde Park     -1.0153e+02  6.8889e+01 -1.4738   0.1486
district_nameJamaica Plain -4.6963e+01  3.9444e+01 -1.1906   0.2410
district_nameMattapan      -9.5009e+01  8.9801e+01 -1.0580   0.2966
district_nameRoxbury       -2.7633e+01  5.0993e+01 -0.5419   0.5910
district_nameSouth Boston  -1.1259e+01  2.9941e+01 -0.3760   0.7089
district_nameSouth End     -2.2583e+01  1.9381e+01 -1.1652   0.2510
unemployment               -5.9114e+01  1.2267e+02 -0.4819   0.6326
medincome_mean             -1.4528e-04  2.4802e-04 -0.5858   0.5614
bachelors                  -1.7955e+01  1.4549e+02 -0.1234   0.9024
one_parent                 -2.9040e+00  1.3005e+02 -0.0223   0.9823
vacant_houses              -1.2311e+01  1.2749e+02 -0.0966   0.9236
married_house               3.3916e+02  2.1558e+02  1.5733   0.1237</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = total_cases ~ travel_work + pct_white + pct_black + 
    asian_pct + nhpt_pct + aian_pct + district_name + unemployment + 
    medincome_mean + bachelors + one_parent + vacant_houses + 
    married_house, data = lm_dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.505  -2.933   0.268   2.451  13.928 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)                 9.794e+01  7.725e+01   1.268   0.2124  
travel_work                -4.019e-05  3.357e-05  -1.197   0.2384  
pct_white                  -1.063e+02  8.608e+01  -1.235   0.2244  
pct_black                   1.108e+02  5.930e+01   1.868   0.0693 .
asian_pct                  -1.278e+02  1.538e+02  -0.831   0.4110  
nhpt_pct                    2.281e+03  2.363e+03   0.966   0.3402  
aian_pct                   -4.921e+02  5.243e+02  -0.939   0.3537  
district_nameDorchester    -5.419e+01  4.178e+01  -1.297   0.2023  
district_nameEast Boston   -3.285e+01  3.243e+01  -1.013   0.3173  
district_nameHyde Park     -1.015e+02  5.010e+01  -2.026   0.0496 *
district_nameJamaica Plain -4.696e+01  2.872e+01  -1.635   0.1101  
district_nameMattapan      -9.501e+01  6.238e+01  -1.523   0.1358  
district_nameRoxbury       -2.763e+01  3.612e+01  -0.765   0.4488  
district_nameSouth Boston  -1.126e+01  2.772e+01  -0.406   0.6868  
district_nameSouth End     -2.258e+01  1.882e+01  -1.200   0.2375  
unemployment               -5.911e+01  9.358e+01  -0.632   0.5313  
medincome_mean             -1.453e-04  1.769e-04  -0.821   0.4164  
bachelors                  -1.795e+01  1.178e+02  -0.152   0.8796  
one_parent                 -2.904e+00  1.260e+02  -0.023   0.9817  
vacant_houses              -1.231e+01  1.089e+02  -0.113   0.9106  
married_house               3.392e+02  1.763e+02   1.924   0.0617 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.091 on 39 degrees of freedom
  (3 observations deleted due to missingness)
Multiple R-squared:  0.9426,    Adjusted R-squared:  0.9131 
F-statistic:    32 on 20 and 39 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(ols) <span class="co">#variables highly correlated, high pvalues, sign of coefficients opposite of their correlation,where you live is the best predictor of the total number of cases, </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       GVIF Df GVIF^(1/(2*Df))
travel_work    6.591104e+01  1        8.118561
pct_white      6.032264e+02  1       24.560668
pct_black      3.741905e+02  1       19.344004
asian_pct      1.338921e+02  1       11.571176
nhpt_pct       4.085129e+00  1        2.021170
aian_pct       2.913079e+00  1        1.706774
district_name  8.835884e+10  8        4.832152
unemployment   2.529459e+01  1        5.029372
medincome_mean 2.393767e+01  1        4.892614
bachelors      1.775908e+02  1       13.326321
one_parent     1.548519e+02  1       12.443952
vacant_houses  1.071442e+01  1        3.273289
married_house  1.701447e+02  1       13.043953</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_step_forward_p</span>(ols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                               Stepwise Summary                                
-----------------------------------------------------------------------------
Step    Variable            AIC        SBC       SBIC        R2       Adj. R2 
-----------------------------------------------------------------------------
 0      Base Model        536.679    540.868    362.921    0.00000    0.00000 
 1      district_name     400.745    421.689    216.894    0.92052    0.90805 
 2      pct_black         398.355    421.393    215.182    0.92613    0.91283 
 3      married_house     396.764    421.896    214.505    0.93042    0.91622 
 4      pct_white         396.361    423.588    215.099    0.93315    0.91783 
 5      medincome_mean    395.147    424.468    215.297    0.93664    0.92046 
 6      travel_work       395.497    426.912    216.916    0.93836    0.92093 
-----------------------------------------------------------------------------

Final Model Output 
------------------

                         Model Summary                          
---------------------------------------------------------------
R                       0.969       RMSE                 5.088 
R-Squared               0.938       MSE                 33.766 
Adj. R-Squared          0.921       Coef. Var           29.372 
Pred R-Squared          0.900       AIC                395.497 
MAE                     3.526       SBC                426.912 
---------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                ANOVA                                 
---------------------------------------------------------------------
                 Sum of                                              
                Squares        DF    Mean Square      F         Sig. 
---------------------------------------------------------------------
Regression    23642.970        13       1818.690    53.862    0.0000 
Residual       1553.214        46         33.766                     
Total         25196.183        59                                    
---------------------------------------------------------------------

                                            Parameter Estimates                                              
------------------------------------------------------------------------------------------------------------
                     model        Beta    Std. Error    Std. Beta      t        Sig        lower      upper 
------------------------------------------------------------------------------------------------------------
               (Intercept)      55.827        37.944                  1.471    0.148     -20.550    132.204 
   district_nameDorchester     -48.253        27.773       -0.706    -1.737    0.089    -104.157      7.650 
  district_nameEast Boston     -20.876        10.466       -0.346    -1.995    0.052     -41.944      0.192 
    district_nameHyde Park     -87.876        31.210       -1.070    -2.816    0.007    -150.699    -25.053 
district_nameJamaica Plain     -39.413        16.384       -0.419    -2.406    0.020     -72.391     -6.434 
     district_nameMattapan     -72.996        43.736       -1.144    -1.669    0.102    -161.031     15.040 
      district_nameRoxbury     -19.653        24.449       -0.326    -0.804    0.426     -68.867     29.561 
 district_nameSouth Boston       4.960        10.713        0.082     0.463    0.646     -16.605     26.525 
    district_nameSouth End     -26.366        14.177       -0.437    -1.860    0.069     -54.903      2.171 
                 pct_black     102.308        49.003        1.281     2.088    0.042       3.670    200.947 
             married_house     396.901       134.101        1.127     2.960    0.005     126.969    666.833 
                 pct_white    -133.780        65.920       -1.465    -2.029    0.048    -266.471     -1.090 
            medincome_mean       0.000         0.000       -0.148    -1.385    0.173       0.000      0.000 
               travel_work       0.000         0.000       -0.214    -1.133    0.263       0.000      0.000 
------------------------------------------------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#attempted variable selection, all the districts were retained, hence their predictive power, travel_work, income, married households also selected based on their significance, </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#socieo economic and race </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ols<span class="ot">&lt;-</span><span class="fu">lm</span>(total_cases<span class="sc">~</span> asian_pct<span class="sc">+</span>pct_white<span class="sc">+</span>pct_black<span class="sc">+</span>nhpt_pct<span class="sc">+</span>aian_pct<span class="sc">+</span>travel_work<span class="sc">+</span>unemployment<span class="sc">+</span>medincome_mean<span class="sc">+</span>bachelors<span class="sc">+</span>one_parent<span class="sc">+</span>married_house, <span class="at">data =</span> lm_dat)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ols, <span class="at">vcov. =</span> vcovHC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                  Estimate  Std. Error t value Pr(&gt;|t|)   
(Intercept)     1.3063e+02  6.7256e+01  1.9423 0.057984 . 
asian_pct      -2.4715e+02  9.4098e+01 -2.6265 0.011544 * 
pct_white      -1.2999e+02  5.6956e+01 -2.2823 0.026942 * 
pct_black      -1.7560e+01  4.0330e+01 -0.4354 0.665222   
nhpt_pct       -1.9587e+03  3.4125e+03 -0.5740 0.568667   
aian_pct        3.1088e+02  1.2231e+03  0.2542 0.800456   
travel_work    -4.6825e-05  2.4781e-05 -1.8895 0.064867 . 
unemployment    7.7196e+01  1.4762e+02  0.5229 0.603430   
medincome_mean -5.9961e-04  2.3820e-04 -2.5173 0.015220 * 
bachelors       2.0468e+02  7.3854e+01  2.7714 0.007918 **
one_parent     -1.4436e+02  7.9823e+01 -1.8085 0.076799 . 
married_house   8.1739e+01  1.0889e+02  0.7507 0.456515   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(ols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     asian_pct      pct_white      pct_black       nhpt_pct       aian_pct 
      7.969246      55.376014      26.808796       2.857756       2.339456 
   travel_work   unemployment medincome_mean      bachelors     one_parent 
      7.667755      13.536832       8.856232      20.632077      11.184373 
 married_house 
     10.914923 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_step_forward_p</span>(ols) <span class="co"># medium income,bachelors,pct_asian, pct_white significant 5% level, one_parent,travel_work at 10%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                               Stepwise Summary                                
-----------------------------------------------------------------------------
Step    Variable            AIC        SBC       SBIC        R2       Adj. R2 
-----------------------------------------------------------------------------
 0      Base Model        536.679    540.868    364.004    0.00000    0.00000 
 1      pct_black         496.985    503.269    324.746    0.50087    0.49226 
 2      travel_work       485.775    494.152    313.789    0.59951    0.58546 
 3      medincome_mean    481.693    492.164    309.881    0.63812    0.61873 
 4      asian_pct         478.236    490.802    306.879    0.66958    0.64555 
 5      one_parent        471.328    485.989    301.496    0.71516    0.68879 
-----------------------------------------------------------------------------

Final Model Output 
------------------

                         Model Summary                          
---------------------------------------------------------------
R                       0.846       RMSE                10.937 
R-Squared               0.715       MSE                132.904 
Adj. R-Squared          0.689       Coef. Var           58.273 
Pred R-Squared          0.651       AIC                471.328 
MAE                     8.960       SBC                485.989 
---------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                ANOVA                                 
---------------------------------------------------------------------
                 Sum of                                              
                Squares        DF    Mean Square      F         Sig. 
---------------------------------------------------------------------
Regression    18019.393         5       3603.879    27.116    0.0000 
Residual       7176.791        54        132.904                     
Total         25196.183        59                                    
---------------------------------------------------------------------

                                      Parameter Estimates                                        
------------------------------------------------------------------------------------------------
         model        Beta    Std. Error    Std. Beta      t        Sig        lower      upper 
------------------------------------------------------------------------------------------------
   (Intercept)     100.173        16.623                  6.026    0.000      66.845    133.500 
     pct_black      46.698        11.284        0.585     4.138    0.000      24.075     69.321 
   travel_work       0.000         0.000       -0.480    -5.526    0.000       0.000      0.000 
medincome_mean       0.000         0.000       -0.426    -4.158    0.000      -0.001      0.000 
     asian_pct    -162.440        43.028       -0.469    -3.775    0.000    -248.706    -76.175 
    one_parent    -149.799        50.957       -0.568    -2.940    0.005    -251.962    -47.637 
------------------------------------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#coefficeint signs alot more interpretable and align with correlation direction, </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#probably should add one more regression with interaction terms </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#map segregation index, relied on tidycensus book </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>race_data<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"White_alone"</span>, <span class="st">"Black_or_African_American_alone"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"American_Indian_and_Alaska_Native_alone"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Asian_alone"</span>, <span class="st">"Native_Hawaiian_and_Other_Pacific_Islander_alone"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>pivot_race<span class="ot">&lt;-</span>final_df<span class="sc">%&gt;%</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, GEOID_TRACT_20)<span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(race_data,<span class="at">names_to =</span><span class="st">'ethnicity'</span>,<span class="at">values_to =</span> <span class="st">'population_count'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ethnicity, GEOID_TRACT_20)<span class="sc">%&gt;%</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_population_count =</span> <span class="fu">mean</span>(population_count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(race_data)

  # Now:
  data %&gt;% select(all_of(race_data))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ethnicity'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pivot_race, <span class="at">n =</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 810 × 3
# Groups:   ethnicity [5]
    ethnicity                               GEOID_TRACT_20 mean_population_count
    &lt;chr&gt;                                            &lt;dbl&gt;                 &lt;dbl&gt;
  1 American_Indian_and_Alaska_Native_alone    25025000102                 111. 
  2 American_Indian_and_Alaska_Native_alone    25025000201                 111. 
  3 American_Indian_and_Alaska_Native_alone    25025000202                 111. 
  4 American_Indian_and_Alaska_Native_alone    25025000301                 111. 
  5 American_Indian_and_Alaska_Native_alone    25025000302                 111. 
  6 American_Indian_and_Alaska_Native_alone    25025000401                 111. 
  7 American_Indian_and_Alaska_Native_alone    25025000402                 111. 
  8 American_Indian_and_Alaska_Native_alone    25025000502                 111. 
  9 American_Indian_and_Alaska_Native_alone    25025000503                 111. 
 10 American_Indian_and_Alaska_Native_alone    25025000505                 111. 
 11 American_Indian_and_Alaska_Native_alone    25025000506                 111. 
 12 American_Indian_and_Alaska_Native_alone    25025000601                 111. 
 13 American_Indian_and_Alaska_Native_alone    25025000603                 111. 
 14 American_Indian_and_Alaska_Native_alone    25025000604                 111. 
 15 American_Indian_and_Alaska_Native_alone    25025000701                 111. 
 16 American_Indian_and_Alaska_Native_alone    25025010500                  38.6
 17 American_Indian_and_Alaska_Native_alone    25025010600                  38.6
 18 American_Indian_and_Alaska_Native_alone    25025010701                  38.6
 19 American_Indian_and_Alaska_Native_alone    25025010702                  38.6
 20 American_Indian_and_Alaska_Native_alone    25025010801                  38.6
 21 American_Indian_and_Alaska_Native_alone    25025010802                  38.6
 22 American_Indian_and_Alaska_Native_alone    25025050101                 313. 
 23 American_Indian_and_Alaska_Native_alone    25025050200                 313. 
 24 American_Indian_and_Alaska_Native_alone    25025050300                 313. 
 25 American_Indian_and_Alaska_Native_alone    25025050400                 313. 
 26 American_Indian_and_Alaska_Native_alone    25025050500                 313. 
 27 American_Indian_and_Alaska_Native_alone    25025050600                 313. 
 28 American_Indian_and_Alaska_Native_alone    25025050700                 313. 
 29 American_Indian_and_Alaska_Native_alone    25025050901                 313. 
 30 American_Indian_and_Alaska_Native_alone    25025051000                 313. 
 31 American_Indian_and_Alaska_Native_alone    25025051101                 313. 
 32 American_Indian_and_Alaska_Native_alone    25025051200                 313. 
 33 American_Indian_and_Alaska_Native_alone    25025060101                  44.7
 34 American_Indian_and_Alaska_Native_alone    25025060200                  44.7
 35 American_Indian_and_Alaska_Native_alone    25025060301                  44.7
 36 American_Indian_and_Alaska_Native_alone    25025060400                  44.7
 37 American_Indian_and_Alaska_Native_alone    25025060501                  44.7
 38 American_Indian_and_Alaska_Native_alone    25025060601                  44.7
 39 American_Indian_and_Alaska_Native_alone    25025060602                  44.7
 40 American_Indian_and_Alaska_Native_alone    25025060700                  44.7
 41 American_Indian_and_Alaska_Native_alone    25025060800                  44.7
 42 American_Indian_and_Alaska_Native_alone    25025061000                  44.7
 43 American_Indian_and_Alaska_Native_alone    25025061101                  44.7
 44 American_Indian_and_Alaska_Native_alone    25025061201                  44.7
 45 American_Indian_and_Alaska_Native_alone    25025061202                 145. 
 46 American_Indian_and_Alaska_Native_alone    25025061203                  44.7
 47 American_Indian_and_Alaska_Native_alone    25025061204                  44.7
 48 American_Indian_and_Alaska_Native_alone    25025070102                  20.2
 49 American_Indian_and_Alaska_Native_alone    25025070103                  20.2
 50 American_Indian_and_Alaska_Native_alone    25025070104                  72.5
 51 American_Indian_and_Alaska_Native_alone    25025070201                  38.6
 52 American_Indian_and_Alaska_Native_alone    25025070202                  29.4
 53 American_Indian_and_Alaska_Native_alone    25025070301                  38.6
 54 American_Indian_and_Alaska_Native_alone    25025070302                  38.6
 55 American_Indian_and_Alaska_Native_alone    25025070402                  91.8
 56 American_Indian_and_Alaska_Native_alone    25025070501                 145. 
 57 American_Indian_and_Alaska_Native_alone    25025070502                 145. 
 58 American_Indian_and_Alaska_Native_alone    25025070600                  91.8
 59 American_Indian_and_Alaska_Native_alone    25025070700                  38.6
 60 American_Indian_and_Alaska_Native_alone    25025070801                 145. 
 61 American_Indian_and_Alaska_Native_alone    25025070802                 145. 
 62 American_Indian_and_Alaska_Native_alone    25025070901                 145. 
 63 American_Indian_and_Alaska_Native_alone    25025070902                 145. 
 64 American_Indian_and_Alaska_Native_alone    25025071101                 145. 
 65 American_Indian_and_Alaska_Native_alone    25025071201                 145. 
 66 American_Indian_and_Alaska_Native_alone    25025080100                 282. 
 67 American_Indian_and_Alaska_Native_alone    25025080300                 301. 
 68 American_Indian_and_Alaska_Native_alone    25025080401                 177. 
 69 American_Indian_and_Alaska_Native_alone    25025080500                 177. 
 70 American_Indian_and_Alaska_Native_alone    25025080601                 177. 
 71 American_Indian_and_Alaska_Native_alone    25025080801                  57.4
 72 American_Indian_and_Alaska_Native_alone    25025080900                  57.4
 73 American_Indian_and_Alaska_Native_alone    25025081001                  57.4
 74 American_Indian_and_Alaska_Native_alone    25025081101                 169. 
 75 American_Indian_and_Alaska_Native_alone    25025081102                  65.5
 76 American_Indian_and_Alaska_Native_alone    25025081200                 169. 
 77 American_Indian_and_Alaska_Native_alone    25025081301                 301. 
 78 American_Indian_and_Alaska_Native_alone    25025081302                 301. 
 79 American_Indian_and_Alaska_Native_alone    25025081400                 179. 
 80 American_Indian_and_Alaska_Native_alone    25025081500                 301. 
 81 American_Indian_and_Alaska_Native_alone    25025081700                 301. 
 82 American_Indian_and_Alaska_Native_alone    25025081800                 214. 
 83 American_Indian_and_Alaska_Native_alone    25025081900                 214. 
 84 American_Indian_and_Alaska_Native_alone    25025082000                  60.2
 85 American_Indian_and_Alaska_Native_alone    25025082100                  60.2
 86 American_Indian_and_Alaska_Native_alone    25025090100                  60.2
 87 American_Indian_and_Alaska_Native_alone    25025090200                  60.2
 88 American_Indian_and_Alaska_Native_alone    25025090300                 122. 
 89 American_Indian_and_Alaska_Native_alone    25025090400                 206. 
 90 American_Indian_and_Alaska_Native_alone    25025090600                 259. 
 91 American_Indian_and_Alaska_Native_alone    25025090700                 163. 
 92 American_Indian_and_Alaska_Native_alone    25025090901                 184. 
 93 American_Indian_and_Alaska_Native_alone    25025091001                 113. 
 94 American_Indian_and_Alaska_Native_alone    25025091100                 184. 
 95 American_Indian_and_Alaska_Native_alone    25025091200                 184. 
 96 American_Indian_and_Alaska_Native_alone    25025091300                 184. 
 97 American_Indian_and_Alaska_Native_alone    25025091400                 184. 
 98 American_Indian_and_Alaska_Native_alone    25025091500                 113. 
 99 American_Indian_and_Alaska_Native_alone    25025091600                  41.2
100 American_Indian_and_Alaska_Native_alone    25025091700                  41.2
# ℹ 710 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>boston_local_seg <span class="ot">&lt;-</span> pivot_race <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutual_local</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"ethnicity"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit =</span> <span class="st">"GEOID_TRACT_20"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="st">"mean_population_count"</span>, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">wide =</span> <span class="cn">TRUE</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> GEOID_TRACT_20)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>boston_local_seg<span class="sc">$</span>GEOID<span class="ot">&lt;-</span><span class="fu">as.character</span>(boston_local_seg<span class="sc">$</span>GEOID)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>MA_tracts_seg <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="st">"MA"</span>, <span class="at">cb =</span> <span class="cn">TRUE</span>, <span class="at">year =</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(boston_local_seg, <span class="at">by =</span> <span class="st">"GEOID"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>with_geometry <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">total_house_units =</span> <span class="st">'B25001_001'</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"MA"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2021</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2017-2021 5-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: • You have not set a Census API key. Users without a key are limited to 500
queries per day and may experience performance limitations.
ℹ For best results, get a Census API key at
http://api.census.gov/data/key_signup.html and then supply the key to the
`census_api_key()` function to use it throughout your tidycensus session.
This warning is displayed once per session.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>MA_tracts_seg<span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> ls)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(with_geometry))<span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"inferno"</span>) <span class="sc">+</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Local</span><span class="sc">\n</span><span class="st">segregation index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare this to geospatial weighted regression maps </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Geography weighted Regression </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Implemented with the GWmodel R package and spgwr package that offer a methods for a geographical robust weighted regreession</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The GWR model computes a local regression model for each location, while including a distance decay function, or a weight added to sum of linear combinations which specifies how observations outside the current location will be weighted</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># relative to their distance. A kernel bandwith is implemented to determine the cutoff distnace for observations that will be included for a locations set of linear combinations</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The GWR model returns local parameter estimates, and the local R-squared quatifying how much variance was captured in a given area. We plot the R-squared statistic for each location in our data below</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#best data to run this is just socieo economic,</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>ols<span class="ot">&lt;-</span><span class="fu">lm</span>(total_cases<span class="sc">~</span> unemployment<span class="sc">+</span>medincome_mean<span class="sc">+</span>bachelors<span class="sc">+</span>one_parent<span class="sc">+</span> vacant_houses<span class="sc">+</span>married_house, <span class="at">data =</span> lm_dat)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ols, <span class="at">vcov. =</span> vcovHC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                  Estimate  Std. Error t value  Pr(&gt;|t|)    
(Intercept)    -3.8347e+01  2.7392e+01 -1.3999  0.167045    
unemployment    2.8739e+02  6.3091e+01  4.5551 2.876e-05 ***
medincome_mean  2.3703e-04  1.2438e-04  1.9056  0.061837 .  
bachelors      -6.6980e+00  3.0756e+01 -0.2178  0.828395    
one_parent      1.0580e+02  5.4337e+01  1.9471  0.056539 .  
vacant_houses  -3.1210e+02  9.6895e+01 -3.2210  0.002129 ** 
married_house  -1.2581e+02  5.2585e+01 -2.3924  0.020117 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = total_cases ~ unemployment + medincome_mean + bachelors + 
    one_parent + vacant_houses + married_house, data = lm_dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.945  -7.541  -1.986   5.430  35.924 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    -3.835e+01  2.915e+01  -1.316  0.19368    
unemployment    2.874e+02  5.892e+01   4.878 9.27e-06 ***
medincome_mean  2.370e-04  1.446e-04   1.639  0.10677    
bachelors      -6.698e+00  4.712e+01  -0.142  0.88747    
one_parent      1.058e+02  5.555e+01   1.905  0.06198 .  
vacant_houses  -3.121e+02  9.893e+01  -3.155  0.00258 ** 
married_house  -1.258e+02  5.093e+01  -2.470  0.01658 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.89 on 56 degrees of freedom
Multiple R-squared:  0.6012,    Adjusted R-squared:  0.5585 
F-statistic: 14.07 on 6 and 56 DF,  p-value: 1.09e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(ols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  unemployment medincome_mean      bachelors     one_parent  vacant_houses 
      1.932586       3.284613       5.747253       6.509955       1.709476 
 married_house 
      3.102446 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_step_forward_p</span>(ols) <span class="co">#variable selction, use the subset, look at statistically significant variables, unemployment has good predictive power  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                               Stepwise Summary                                
-----------------------------------------------------------------------------
Step    Variable            AIC        SBC       SBIC        R2       Adj. R2 
-----------------------------------------------------------------------------
 0      Base Model        564.807    569.093    384.310    0.00000    0.00000 
 1      one_parent        540.219    546.649    359.970    0.34428    0.33354 
 2      unemployment      523.092    531.664    343.856    0.51599    0.49985 
 3      vacant_houses     521.363    532.079    342.444    0.54380    0.52060 
 4      married_house     518.361    531.220    340.214    0.57862    0.54956 
 5      medincome_mean    516.914    531.916    339.592    0.60105    0.56606 
-----------------------------------------------------------------------------

Final Model Output 
------------------

                         Model Summary                          
---------------------------------------------------------------
R                       0.775       RMSE                13.098 
R-Squared               0.601       MSE                189.611 
Adj. R-Squared          0.566       Coef. Var           65.621 
Pred R-Squared          0.513       AIC                516.914 
MAE                     9.801       SBC                531.916 
---------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                ANOVA                                 
---------------------------------------------------------------------
                 Sum of                                              
                Squares        DF    Mean Square      F         Sig. 
---------------------------------------------------------------------
Regression    16283.143         5       3256.629    17.175    0.0000 
Residual      10807.841        57        189.611                     
Total         27090.984        62                                    
---------------------------------------------------------------------

                                       Parameter Estimates                                        
-------------------------------------------------------------------------------------------------
         model        Beta    Std. Error    Std. Beta      t        Sig        lower       upper 
-------------------------------------------------------------------------------------------------
   (Intercept)     -40.710        23.741                 -1.715    0.092     -88.250       6.831 
    one_parent     111.453        38.466        0.432     2.897    0.005      34.426     188.481 
  unemployment     289.787        55.970        0.577     5.178    0.000     177.709     401.865 
 vacant_houses    -310.211        97.187       -0.346    -3.192    0.002    -504.825    -115.598 
 married_house    -123.882        48.674       -0.362    -2.545    0.014    -221.351     -26.414 
medincome_mean       0.000         0.000        0.241     1.790    0.079       0.000       0.000 
-------------------------------------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>geo_dat<span class="ot">&lt;-</span>final_df<span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district_name,year)<span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">aian_pct =</span> <span class="fu">mean</span>(American_Indian_and_Alaska_Native_alone<span class="sc">/</span>total_pop),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">nhpt_pct =</span> <span class="fu">mean</span>(Native_Hawaiian_and_Other_Pacific_Islander_alone<span class="sc">/</span>total_pop), </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">asian_pct =</span> <span class="fu">mean</span>(Asian_alone<span class="sc">/</span>total_pop),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_black =</span> <span class="fu">mean</span>(Black_or_African_American_alone<span class="sc">/</span>total_pop),</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_white =</span> <span class="fu">mean</span>(White_alone<span class="sc">/</span>total_pop),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">unemployment=</span><span class="fu">mean</span>(not_in_labor_force<span class="sc">/</span>total_pop),</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">medincome_mean=</span> <span class="fu">mean</span>(household_medincome),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">bachelors =</span> <span class="fu">mean</span>(bachelors_25<span class="sc">/</span>total_pop),</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">one_parent=</span> <span class="fu">mean</span>(one_parent<span class="sc">/</span>total_house_units),</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">married_house=</span> <span class="fu">mean</span>(married_households<span class="sc">/</span>total_house_units),</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">vacant_houses =</span> <span class="fu">mean</span>(vacancy_status<span class="sc">/</span>total_house_units),</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">travel_work =</span> <span class="fu">mean</span>(aggregate_time_to_work),</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_cases =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">duplicated</span>(incident_num)),</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">geometry =</span> geometry)<span class="sc">%&gt;%</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'district_name', 'year'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>geo_reg<span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(geo_dat)<span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_Spatial</span>()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#limitation: travel_work has na values, cannot include this in model, even though it would be great to have that plotted </span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#other variables we should add to aid analysis?</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>formula2 <span class="ot">&lt;-</span> <span class="st">"total_cases~ unemployment+ vacant_houses+medincome_mean+bachelors+one_parent+married_house"</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> formula2, </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> geo_reg, </span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"bisquare"</span>,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive =</span> <span class="cn">TRUE</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Adaptive bandwidth: 847 CV score: 71130.37 
Adaptive bandwidth: 531 CV score: 51708.41 
Adaptive bandwidth: 335 CV score: 43495.66 
Adaptive bandwidth: 214 CV score: 37727.55 
Adaptive bandwidth: 139 CV score: 33522.04 
Adaptive bandwidth: 93 CV score: 32181.93 
Adaptive bandwidth: 64 CV score: 39041.94 
Adaptive bandwidth: 110 CV score: 31995.46 
Adaptive bandwidth: 122 CV score: 32516.51 
Adaptive bandwidth: 104 CV score: 32005.56 
Adaptive bandwidth: 115 CV score: 32030.55 
Adaptive bandwidth: 108 CV score: 32090.78 
Adaptive bandwidth: 112 CV score: 32049.14 
Adaptive bandwidth: 109 CV score: 31976.19 
Adaptive bandwidth: 108 CV score: 32090.78 
Adaptive bandwidth: 109 CV score: 31976.19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>gw_model <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> formula2, </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> geo_reg, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> bw,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"bisquare"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive =</span> <span class="cn">TRUE</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>gw_model_results <span class="ot">&lt;-</span> gw_model<span class="sc">$</span>SDF <span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co">#map for R^2</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gw_model_results, <span class="fu">aes</span>(<span class="at">fill =</span> Local_R2)) <span class="sc">+</span> </span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#great R-squared and all of our variables are statistically significant at least 10% level, this is good</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#map for beta, choose the fill variable/beta coefficient </span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#where is the effect positive and negative, </span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gw_model_results, <span class="fu">aes</span>(<span class="at">fill =</span> unemployment)) <span class="sc">+</span> </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Local β Unemployment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>