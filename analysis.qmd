---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
---

![](images/analysis.webp)

## **Introduction**

Urban violence remains a pervasive challenge that affects cities worldwide. In Boston, variations in violent crime rates across different neighborhoods suggest a complex interplay of socioeconomic factors. This study aims to dissect the relationship between socioeconomic status—measured through variables such as income, employment, and education—and the frequency of gun violence within Boston's diverse districts. By exploring these relationships, the study seeks to identify potential mechanisms for policy action that could mitigate violence and enhance urban safety.

Our analysis revolves around several pivotal questions: Does higher income correlate with lower incidences of gun violence? What role does employment stability play in mitigating urban violence? How does educational attainment influence these dynamics? We hypothesized that higher socioeconomic status, indicated by increased income levels, stable employment, and higher educational attainment, is associated with reduced instances of gun violence. To test these hypotheses, we employ statistical models, including linear and logistic regressions, to examine these relationships, focusing on extracting meaningful patterns from a decade of data. This approach allows us to assess the strength and significance of these socioeconomic factors in relation to urban violence, providing a data-driven basis for recommendations and policy considerations.

## **Analysis**

We focused on R-squared/adjusted R-squared, our models capture a majority of the variance in our dependent variable, total cases. Therefore, our choice of variables are good indicators and have substantial predictive power for the number of incidents in a given district. 

## **Summary Statistics**
Correlations of our independent variables with total cases, correlation table seems intuitive, for example as unemployment increases, total cases also increase. Show the distribution of our variables, include more creative plots for appeal, reference tidycensus,Rfor data science books.

## **Modeling**
Good R-Squared, above 90 for adjusted R-squared which is key, look at the relationship across spatial, socio-economic, and racial features, geospatial analysis to weight the proximity of our locations, plot Beta, which regressors are more impactful, compare to segregation index and map.

```{r setup, echo=FALSE, results='hide'}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r echo=FALSE, results='hide'}

library(tidycensus)
library(tidyverse)
library(sandwich)
library(lmtest)
library(car)
library(leaps)
library(segregation)
library(tigris)
library(sf)
library(olsrr)
library(GWmodel)
library(corrplot)
library(MASS)
library(stargazer)

final_df<-readRDS('all_census_dat.rdr')



lm_dat<-final_df%>%
  group_by(district_name, year)%>%
  summarise(pct_aian = mean(American_Indian_and_Alaska_Native_alone/total_pop),
            pct_nhpt = mean(Native_Hawaiian_and_Other_Pacific_Islander_alone/total_pop), 
            pct_asian = mean(Asian_alone/total_pop),
            pct_black = mean(Black_or_African_American_alone/total_pop),
            pct_white = mean(White_alone/total_pop),
            unemployment=mean(not_in_labor_force/total_pop),
            medincome_mean= mean(household_medincome),
            bachelors = mean(bachelors_25/total_pop),
            one_parent= mean(one_parent/total_house_units),
            married_house= mean(married_households/total_house_units),
            vacant_houses = mean(vacancy_status/total_house_units),
            total_cases = sum(!duplicated(incident_num)))



```





## **Descriptive Statistics: Correlation of Relevant Factors**
To understand the underlying relationship between our independent and dependent variables, we calculated the correlation matrix to display the direction and magnitude of the relationships present in our data. As shown by the bottom row of our table, our dependent variable total cases is positively correlated with unemployment, the proportion ofsingle parent households in given district and percentage of the population that is black or African American. For interpretation, it is important to note that this does not imply a causal effect, and the following analysis will explain why certain demographics are more correlated with with total incidents by further exploring socioeconomic effects. 


```{r echo=FALSE, results='hide'}

matrix<-lm_dat%>%
  ungroup()%>%
  dplyr::select(-district_name,-year)%>%
  cor()

corrplot(matrix, method = 'color')

```




## **Exploratory Analysis: Relationships Between Variables**




```{r echo=FALSE, results='hide'}

ggplot(lm_dat, aes(medincome_mean, total_cases, color = year))+
  geom_point()+
  geom_smooth(method = 'lm', se=FALSE)+
  facet_wrap(~district_name, scales = 'free_x')+
  labs(x = 'Median Income', y = 'Total Cases', Title = 'Relationship between Median Income and Total Cases')


ggplot(lm_dat, aes(one_parent, total_cases, color = year))+
  geom_point()+
  geom_smooth(method = 'lm', se=FALSE)+
  facet_wrap(~district_name, scales = 'free_x')+
  labs(x = 'Single Parent', y = 'Total Cases', Title = 'Relationship between One Parent Households and Total Cases')


ggplot(lm_dat, aes(bachelors, total_cases, color = year))+
  geom_point()+
  geom_smooth(method = 'lm', se=FALSE)+
  facet_wrap(~district_name, scales = 'free_x')+
  labs(x = 'Pct of Population with Bachelors', y = 'Total Cases', Title = 'Relationship between Bachelors and Total Cases')

```


```{r echo=FALSE, results='hide'}

drop<-c(lm_dat$total_cases,lm_dat$travel_work,lm_dat$district_name,lm_dat$aian_pct,lm_dat$nhpt_pct ,lm_dat$asian_pct,lm_dat$pct_black,lm_dat$pct_white)


df_long <- pivot_longer(lm_dat, cols = c(-year,-total_cases,-district_name,-pct_aian,-pct_nhpt,
                                         -pct_asian,-pct_black,-pct_white), names_to = "Variable", values_to = "Value")

facet_dat<-df_long%>%
  group_by(year, Variable, district_name)%>%
  summarise(district_name = district_name, total_cases = sum(total_cases), value = Value)



# Create the faceted scatter plot
ggplot(facet_dat, aes(x = value, y = total_cases)) +
  geom_point(aes(color = district_name)) +
  facet_wrap(~ Variable, scales = "free") +
  geom_smooth(method='lm', se=FALSE)+
  theme_minimal()+
  labs(y = 'Total Cases', title='Socioeconomic Variables and Total Cases')


```


```{r echo=TRUE, results = 'hide' }
#ols all variables 

#OLS with all variables 
 
#Log regression for all variables to normalize output, 

full_model <- stepAIC(lm(log(total_cases) ~  pct_white+pct_black+pct_asian+pct_nhpt+pct_aian+district_name+ unemployment+ medincome_mean+bachelors+one_parent+ vacant_houses+married_house, data = lm_dat), direction = "both")


stargazer(full_model, title="Log Regression Results", align=TRUE, se = 'HC1') #html standard output table 


#nonlinear, polynomial regression, refer to scatter plots to see the non linearity, 
non_linear<-stepAIC(lm(total_cases ~ pct_asian+pct_nhpt+pct_aian+ unemployment+ medincome_mean+I(medincome_mean^2)+bachelors+I(bachelors^2)+one_parent+ vacant_houses, data = lm_dat), direction = "both")


stargazer(non_linear, title="Non-Linear Regression Results", align=TRUE, se = 'HC1')


```




```{r echo=FALSE, results='hide'}

#map segregation index, relied on tidycensus book 

race_data<-c("White_alone", "Black_or_African_American_alone",
             "American_Indian_and_Alaska_Native_alone",
             "Asian_alone", "Native_Hawaiian_and_Other_Pacific_Islander_alone")


pivot_race<-final_df%>%
  group_by(year, GEOID_TRACT_20)%>%
  pivot_longer(race_data,names_to ='ethnicity',values_to = 'population_count')%>%
  ungroup()%>%
  group_by(ethnicity, GEOID_TRACT_20)%>%
  summarise(mean_population_count = mean(population_count))

print(pivot_race, n =100)

boston_local_seg <- pivot_race %>%
  mutual_local(
    group = "ethnicity",
    unit = "GEOID_TRACT_20",
    weight = "mean_population_count", 
    wide = TRUE
  )%>%
  rename(GEOID = GEOID_TRACT_20)

boston_local_seg$GEOID<-as.character(boston_local_seg$GEOID)

MA_tracts_seg <- tracts("MA", cb = TRUE, year = 2020) %>%
  inner_join(boston_local_seg, by = "GEOID") 

with_geometry <- get_acs(
  geography = "tract",
  variables = c(total_house_units = 'B25001_001'),
  state = "MA",
  geometry = TRUE,
  year = 2021
)


MA_tracts_seg%>%
  ggplot(aes(fill = ls)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = st_crs(with_geometry))+
  scale_fill_viridis_c(option = "inferno") + 
  theme_void() + 
  labs(fill = "Local\nsegregation index")


#compare this to geospatial weighted regression maps 


seg_lm<-boston_local_seg%>%
  rename(GEOID_TRACT_20 = GEOID)%>%
  mutate(GEOID_TRACT_20 = as.double(GEOID_TRACT_20))%>%
  left_join(final_df,select(GEOID_TRACT_20, incident_num,year, district_name), by = 'GEOID_TRACT_20')%>%
  group_by(GEOID_TRACT_20)%>%
  summarise(district = district_name, year = year, total_cases = sum(!duplicated(incident_num)),seg_index = ls)


ols<-lm(total_cases~ seg_index, data = seg_lm)
coeftest(ols, vcov.=vcovHC)

library(ggpmisc)


#map segregation index vs total cases 
seg_lm%>%
  ungroup()%>%
  distinct()%>%
  ggplot( aes(seg_index, total_cases))+
    geom_point(aes(color= district))+
    geom_smooth(method = 'lm', se=FALSE) +
    stat_poly_eq()+
    scale_color_discrete(name = "District")+
    labs(x = 'Segregation Index', y = 'Total Cases', Title= 'Relationship Between Total Cases and Segregation Index')
  
  

```


```{r echo=FALSE, results='hide'}

#Geography weighted Regression 

#Implemented with the GWmodel R package and spgwr package that offer a methods for a geographical robust weighted regreession
# The GWR model computes a local regression model for each location, while including a distance decay function, or a weight added to sum of linear combinations which specifies how observations outside the current location will be weighted
# relative to their distance. A kernel bandwith is implemented to determine the cutoff distnace for observations that will be included for a locations set of linear combinations
# The GWR model returns local parameter estimates, and the local R-squared quatifying how much variance was captured in a given area. We plot the R-squared statistic for each location in our data below
#


geo_dat<-final_df%>%
  group_by(district_name,year)%>%
  summarise(aian_pct = mean(American_Indian_and_Alaska_Native_alone/total_pop),
            nhpt_pct = mean(Native_Hawaiian_and_Other_Pacific_Islander_alone/total_pop), 
            asian_pct = mean(Asian_alone/total_pop),
            pct_black = mean(Black_or_African_American_alone/total_pop),
            pct_white = mean(White_alone/total_pop),
            unemployment=mean(not_in_labor_force/total_pop),
            medincome_mean= mean(household_medincome),
            bachelors = mean(bachelors_25/total_pop),
            one_parent= mean(one_parent/total_house_units),
            married_house= mean(married_households/total_house_units),
            vacant_houses = mean(vacancy_status/total_house_units),
            total_cases = sum(!duplicated(incident_num)),
            geometry = geometry)%>%
  distinct()

geo_reg<-st_as_sf(geo_dat)%>%
  as_Spatial()

#limitation: travel_work has na values, cannot include this in model, even though it would be great to have that plotted 

#other variables we should add to aid analysis?

formula2 <- "log(total_cases) ~ asian_pct+nhpt_pct+aian_pct+ unemployment+ medincome_mean+bachelors+one_parent+ vacant_houses"

##log regression results, non linear coefficints difficult to interpret 


bw <- bw.gwr(
  formula = formula2, 
  data = geo_reg, 
  kernel = "bisquare",
  adaptive = TRUE
)

gw_model <- gwr.basic(
  formula = formula2, 
  data = geo_reg, 
  bw = bw,
  kernel = "bisquare",
  adaptive = TRUE
)

gw_model_results <- gw_model$SDF %>%
  st_as_sf() 

#map for R^2
ggplot(gw_model_results, aes(fill = Local_R2)) + 
  geom_sf(color = NA) + 
  scale_fill_viridis_c() + 
  theme_void()+
  labs(fill = 'Local R2')

#great R-squared and all of our variables are statistically significant at least 10% level, this is good


#where is the effect positive and negative, 
ggplot(gw_model_results, aes(fill = bachelors)) + 
  geom_sf(color = NA) + 
  scale_fill_viridis_c(name = "Local β Bachelors", limits = quantile(gw_model_results$one_parent, c(0.05, 0.95))) +  # Set limits
  theme_void() + 
  labs(fill = "Local β Bachelors")






```

## **Limitations**

The analysis conducted in this study faces several potential issues related to the data that could impact the validity and reliability of the findings. Among these is the inconsistency in reporting across different districts, which may arise from variations in how incidents are classified or documented by different officers, leading to differences in data quality. Moreover, the dataset excludes justifiable and self-inflicted shootings, potentially skewing the comprehensive understanding of the city’s gun violence.

Additional challenges include potential biases in how incidents are reported. Systemic biases within law enforcement practices could influence reporting rates. For example, certain neighborhoods may experience underreporting due to strained community-police relations or resource constraints. Furthermore, differing enforcement practices could lead to an overrepresentation of certain demographics as victims, introducing biases that may distort the perceived demographic patterns of gun violence.

These factors call for a cautious interpretation of the study’s results and point to the need for further research. Incorporating variables such as police presence, public health initiatives, and community programs, could provide a fuller picture of the factors influencing urban violence. Moreover, while this study identifies correlations between socioeconomic status and gun violence, establishing causation requires additional longitudinal and experimental research to explore the underlying mechanisms more definitively.
